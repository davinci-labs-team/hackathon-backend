// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  PARTICIPANT
  JURY
  MENTOR
  ORGANIZER
}

model User {
  id             String   @id @default(uuid())
  supabaseUserId String   @unique
  firstname      String
  lastname       String
  email          String   @unique
  createdAt      DateTime @default(now())
  role           Role     @default(PARTICIPANT)
  school         String?
  bio            String?
  interests      String[]
  linkedin       String?
  github         Json?
  discord        Json?
  profilePicturePath String?
  invitationSent Boolean  @default(false)
  favoriteSubjectId String?

  // 1:N
  teamId   String? 
  team     Team?   @relation("TeamMembers", fields: [teamId], references: [id])

  juryTeams   Team[]  @relation("TeamJuries")

  mentorTeams Team[]  @relation("TeamMentors")
}

model Faq {
  id        String   @id @default(uuid())
  question  String
  answer    String
  isPrivate Boolean  @default(false)
  createdAt DateTime @default(now())
}

model HackathonConfig {
  id        String   @id @default(uuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Announcement {
  id        String  @id @default(uuid())
  title     String
  author    String
  tags      Json?
  files     Json?
  content   String
  isPrivate Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Ticket {
  id                 Int      @id @default(autoincrement())
  emitter_platform_id String
  status             Status   @default(OPEN)
  channel_id         String
  user_discord_id    String
}

enum Status {
  OPEN
  CLOSE
}

enum TeamStatus {
  LOCKED
  UNLOCKED
}

model Team {
  id          String     @id @default(uuid())
  name        String
  description String?
  
  themeId     String
  subjectId   String
  status      TeamStatus @default(UNLOCKED)
  ignoreConstraints Boolean   @default(false)
  createdAt   DateTime   @default(now())

  // 1:N
  members     User[]     @relation("TeamMembers")

  // N:N
  juries      User[]     @relation("TeamJuries")

  // N:N
  mentors     User[]     @relation("TeamMentors")
}

model Submission {
  id          String              @id @default(uuid())
  teamId      String              @unique
  grade       Float?              // moyenne des notes des juries
  status      SubmissionStatus    @default(NOT_SUBMITTED)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  submissionFilePath String?      // File path du documents de soumission (.zip)
  githubLink  String?             // Lien GitHub du projet soumis

  // Relations
  evaluations Evaluation[]        // évaluations des jurys
  comments    Comment[]           // commentaires des mentors
}

model Evaluation {
  id            String      @id @default(uuid())
  submissionId  String
  juryId        String
  grade         Float       // note donnée par un jury
  comment       String?     // commentaire optionnel du jury
  createdAt     DateTime    @default(now())

  evaluationFilePath String? 

  submission    Submission  @relation(fields: [submissionId], references: [id])

  @@unique([submissionId, juryId])
}

model Comment {
  id            String      @id @default(uuid())
  submissionId  String
  mentorId      String
  content       String
  createdAt     DateTime    @default(now())

  submission    Submission  @relation(fields: [submissionId], references: [id])
}

enum SubmissionStatus {
  GRADED
  PENDING
  NOT_SUBMITTED
}